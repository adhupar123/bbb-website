<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>About — Methods & Results</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .chart-wrapper {
      position: relative;
      width: 100%;
      height: 300px;
      margin: 20px 0;
    }
    .chart-wrapper.large { height: 400px; }
    .chart-wrapper canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
    }
    .equation-box {
      background: #f0f4ff;
      border-left: 4px solid #0b5fff;
      padding: 16px;
      margin: 16px 0;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      overflow-x: auto;
    }
    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    .metric-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    .metric-value {
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
    }
    .metric-label {
      font-size: 14px;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <header class="navwrap"><div class="container topbar"><div class="brand"><h1>About — Methods & Results</h1><div class="muted">Comprehensive analysis of BBB permeability prediction</div></div>
  <nav class="mainnav"><a href="index.html">Home</a><a href="simulate.html">Simulator</a></nav></div></header>
  
  <main class="container">
    
    <!-- Introduction -->
    <section class="card">
      <h2>Project Overview</h2>
      <p class="lead">The blood-brain barrier (BBB) is a highly selective semipermeable border that separates circulating blood from the brain and extracellular fluid in the central nervous system. Understanding which drugs can cross this barrier is crucial for developing effective treatments for neurological disorders.</p>
      <p>This project analyzes the relationship between molecular descriptors and BBB permeability to create a predictive model. By examining approximately 1,000 drugs with known BBB penetration data (LogBB values), we aim to generate a mathematical equation that can predict a drug's ability to cross the BBB based on its chemical and physical properties.</p>
    </section>

    <!-- Dataset -->
    <section class="card">
      <h2>Dataset</h2>
      <p>The dataset was sourced from GitHub and originally contained ~7,000 drugs. Our analysis focuses on a subset of ~1,000 drugs that include experimental LogBB values.</p>
      <p><strong>LogBB (log of Blood-Brain ratio)</strong> is an experimental value that describes the concentration of a drug on either side of the BBB:</p>
      <ul>
        <li><strong>Positive LogBB</strong>: Higher concentration inside the brain (good BBB penetration)</li>
        <li><strong>Negative LogBB</strong>: Higher concentration in blood (poor BBB penetration)</li>
        <li><strong>LogBB ≈ 0</strong>: Equal distribution across the barrier</li>
      </ul>
    </section>

    <!-- Molecular Descriptors -->
    <section class="card">
      <h2>Molecular Descriptors</h2>
      <p>Using RDKit, we extracted the following molecular descriptors from SMILES formulas (computer-friendly chemical representations):</p>
      <div class="grid">
        <div class="tile">
          <h4>MolLogP (Lipophilicity)</h4>
          <p>Measures compound solubility and its ability to cross lipid membranes. Higher values indicate greater lipophilicity.</p>
        </div>
        <div class="tile">
          <h4>MolWt (Molecular Weight)</h4>
          <p>Larger molecules are less likely to diffuse across membranes. Typical CNS drugs are under 500 Da.</p>
        </div>
        <div class="tile">
          <h4>TPSA (Topological Polar Surface Area)</h4>
          <p>Related to compound polarity. Lower TPSA generally correlates with better membrane permeability.</p>
        </div>
        <div class="tile">
          <h4>FC (Formal Charge)</h4>
          <p>Charged molecules have difficulty crossing lipid membranes. Neutral compounds typically cross more easily.</p>
        </div>
        <div class="tile">
          <h4>Aromatic Rings</h4>
          <p>Can impact membrane solubility and molecular rigidity, affecting BBB penetration.</p>
        </div>
        <div class="tile">
          <h4>Heavy Atoms</h4>
          <p>Contributes to molecular weight. Higher counts generally indicate larger, more complex molecules.</p>
        </div>
      </div>
    </section>

    <!-- Methodology -->
    <section class="card">
      <h2>Methodology</h2>
      <h3>1. Data Preprocessing</h3>
      <p>Molecular descriptors were computed for each drug using RDKit. The dataset was cleaned and prepared for modeling, with features standardized for regression analysis.</p>
      
      <h3>2. Multiple Linear Regression</h3>
      <p>We fitted a multiple linear regression model to predict LogBB values based on the six molecular descriptors. This model allows us to understand the individual contribution of each feature to BBB permeability.</p>

      <h3>3. Classification Model</h3>
      <p>A binary classification model was developed to predict whether a drug can effectively cross the BBB (LogBB > 0) or not (LogBB ≤ 0).</p>
    </section>

    <!-- Results - Regression Coefficients -->
    <section class="card">
      <h2>Results: Regression Analysis</h2>
      <p>The multiple linear regression revealed the following relationship between molecular descriptors and LogBB:</p>
      
      <div class="equation-box">
        <strong>Predictive Equation:</strong><br>
        LogBB = 0.2407 + (−0.0115 × MolLogP) + (−0.0013 × MolWt) + (−0.0133 × TPSA) + (0.0172 × FC) + (−0.1323 × Aromatic Rings) + (0.0512 × Heavy Atoms)
      </div>

      <h3>Coefficient Interpretation</h3>
      <div class="chart-wrapper">
        <canvas id="coefChart"></canvas>
      </div>
      
      <p><strong>Key Findings:</strong></p>
      <ul>
        <li><strong>Heavy Atoms (0.0512)</strong>: Positive coefficient suggests that within the dataset's range, heavy atoms correlate with increased BBB penetration</li>
        <li><strong>Aromatic Rings (−0.1323)</strong>: Strong negative coefficient indicates that more aromatic rings reduce BBB permeability</li>
        <li><strong>TPSA (−0.0133)</strong>: Negative coefficient confirms that higher polarity reduces BBB penetration</li>
        <li><strong>MolLogP (−0.0115)</strong>: Surprisingly negative, possibly due to the balance between solubility and other factors</li>
        <li><strong>Formal Charge (0.0172)</strong>: Small positive coefficient, though typically charged molecules have difficulty crossing</li>
      </ul>
    </section>

    <!-- Sample Data Visualization -->
    <section class="card">
      <h2>Data Exploration: LogBB vs MolLogP</h2>
      <p>This scatter plot shows the relationship between lipophilicity (MolLogP) and BBB penetration (LogBB) for a sample of compounds:</p>
      <div class="chart-wrapper">
        <canvas id="scatterChart"></canvas>
      </div>
      <p class="small">Each point represents a compound. The relationship shows the complexity of BBB penetration - it's not determined by a single factor alone.</p>
    </section>

    <!-- ECDF -->
    <section class="card">
      <h2>Distribution Analysis: MolLogP ECDF</h2>
      <p>The Empirical Cumulative Distribution Function (ECDF) shows how lipophilicity values are distributed across our sample:</p>
      <div class="chart-wrapper">
        <canvas id="ecdfChart"></canvas>
      </div>
      <p class="small">This helps us understand the typical range of lipophilicity in BBB-permeable compounds.</p>
    </section>

    <!-- Model Performance -->
    <section class="card">
      <h2>Model Performance</h2>
      
      <h3>Regression Model: Predicted vs Actual</h3>
      <p>The scatter plot below compares our model's predictions against actual LogBB values. The red dashed line represents perfect prediction (y = x):</p>
      <div class="chart-wrapper large">
        <canvas id="predActChart"></canvas>
      </div>
      <p class="small">Points close to the line indicate accurate predictions. The spread shows the model's prediction variance.</p>

      <h3>Classification Performance</h3>
      <div class="metric-grid">
        <div class="metric-card">
          <div class="metric-label">Overall Accuracy</div>
          <div class="metric-value">62.9%</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">True Negatives</div>
          <div class="metric-value">532</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">True Positives</div>
          <div class="metric-value">120</div>
        </div>
      </div>

      <div style="display:flex;gap:18px;align-items:center;flex-wrap:wrap;margin-top:20px">
        <canvas id="confMat" width="260" height="220" style="background:#fff;border-radius:8px;border:1px solid #eef3ff"></canvas>
        <div>
          <p><strong>Confusion Matrix:</strong></p>
          <pre id="confText" style="background:#f8fafc;border-radius:6px;padding:10px;border:1px solid #eef3ff;font-size:14px">[[532,  12],
 [372, 120]]</pre>
          <p class="small">Rows = actual class (0=poor BBB penetration, 1=good BBB penetration)<br>
          Columns = predicted class</p>
          <p><strong>Interpretation:</strong> The model correctly identified 532 compounds with poor BBB penetration and 120 with good penetration. However, it had 372 false negatives (predicted poor when actually good), suggesting the model is conservative in predicting BBB penetration.</p>
        </div>
      </div>
    </section>

    <!-- Sample Data Table -->
    <section class="card">
      <h2>Sample Compounds</h2>
      <p>Below are examples of compounds from our dataset with their molecular descriptors and predicted vs actual LogBB values:</p>
      <table class="datatable" id="sampleTable"></table>
    </section>

    <!-- Conclusions -->
    <section class="card">
      <h2>Conclusions & Future Work</h2>
      <h3>Key Takeaways</h3>
      <ul>
        <li>Aromatic rings have the strongest negative impact on BBB permeability in our model</li>
        <li>Multiple molecular descriptors contribute to BBB penetration, confirming the complexity of this phenomenon</li>
        <li>The regression model provides a quantitative equation for predicting LogBB values</li>
        <li>Classification accuracy of 62.9% suggests room for improvement with more sophisticated models</li>
      </ul>
      
      <h3>Limitations</h3>
      <ul>
        <li>Linear regression assumes linear relationships between descriptors and LogBB</li>
        <li>The model doesn't capture complex interactions between molecular features</li>
        <li>Dataset size (~1,000 compounds) is relatively small for machine learning standards</li>
      </ul>

      <h3>Future Directions</h3>
      <ul>
        <li>Explore non-linear models (Random Forest, Neural Networks) for improved accuracy</li>
        <li>Include additional molecular descriptors (hydrogen bond donors/acceptors, molecular flexibility)</li>
        <li>Investigate feature interactions and polynomial terms</li>
        <li>Validate model on external datasets</li>
      </ul>
    </section>

  </main>
  
  <footer class="footer"><div class="container"><small>© 2025 Alex — BBB Transport Project</small></div></footer>

  <script>
    // Data from notebook
    const intercept = 0.2407;
    const coeffs = {
      'Heavy Atoms': 0.0512,
      'FC': 0.0172,
      'MolWt': -0.0013,
      'MolLogP': -0.0115,
      'TPSA': -0.0133,
      'Aromatic Rings': -0.1323
    };

    const samples = [
      {compound: 'moxalactam', logBB: -2.52, MolLogP: -1.1277, MolWt: 520.48, TPSA: 206.3, FC:0, AromaticRings:2, HeavyAtoms:36},
      {compound: 'schembl614298', logBB: -2.15, MolLogP: -1.2365, MolWt: 461.467, TPSA:149.15, FC:0, AromaticRings:1, HeavyAtoms:33},
      {compound: 'morphine-6-glucuronide', logBB: -2.09, MolLogP: -0.8854, MolWt:461.467, TPSA:149.15, FC:0, AromaticRings:1, HeavyAtoms:33},
      {compound: '2-[4-(5-bromo-3-methylpyridin-2-yl)...]', logBB: -1.88, MolLogP: 2.63014, MolWt:446.393, TPSA:78.94, FC:0, AromaticRings:2, HeavyAtoms:28},
      {compound: 'sucrose', logBB: -1.70, MolLogP: -5.3956, MolWt:342.297, TPSA:189.53, FC:0, AromaticRings:0, HeavyAtoms:23}
    ];

    function predictRow(row){
      return intercept
        + coeffs['MolLogP'] * row.MolLogP
        + coeffs['MolWt'] * row.MolWt
        + coeffs['TPSA'] * row.TPSA
        + coeffs['FC'] * row.FC
        + coeffs['Aromatic Rings'] * row.AromaticRings
        + coeffs['Heavy Atoms'] * row.HeavyAtoms;
    }
    for(const s of samples){
      s.predicted = Number(predictRow(s).toFixed(3));
    }

    // Coefficient bar chart
    Chart.defaults.responsive = true;
    Chart.defaults.maintainAspectRatio = false;

    const ctxCoef = document.getElementById('coefChart').getContext('2d');
    new Chart(ctxCoef, {
      type: 'bar',
      data: {
        labels: Object.keys(coeffs),
        datasets: [{
          label: 'Coefficient Value',
          data: Object.values(coeffs),
          backgroundColor: function(context) {
            const value = context.parsed.y;
            return value >= 0 ? '#10b981' : '#ef4444';
          }
        }]
      },
      options: {
        indexAxis: 'y',
        plugins: {
          legend: {display: false},
          title: {display: true, text: 'Regression Coefficients by Feature'}
        },
        scales: {
          x: {title: {display: true, text: 'Coefficient Value'}}
        }
      }
    });

    // Scatter plot
    const ctxScatter = document.getElementById('scatterChart').getContext('2d');
    new Chart(ctxScatter, {
      type: 'scatter',
      data: {
        datasets: [{
          label: 'LogBB vs MolLogP',
          data: samples.map(s => ({x: s.MolLogP, y: s.logBB})),
          backgroundColor: '#0b5fff'
        }]
      },
      options: {
        scales: {
          x: {title: {display: true, text: 'MolLogP (Lipophilicity)'}},
          y: {title: {display: true, text: 'LogBB (BBB Penetration)'}}
        },
        plugins: {
          legend: {display: false},
          title: {display: true, text: 'Relationship Between Lipophilicity and BBB Penetration'}
        }
      }
    });

    // ECDF
    function ecdf(arr){
      const sorted = arr.slice().sort((a,b)=>a-b);
      return sorted.map((v,i)=>({x:v,y:(i+1)/sorted.length}));
    }
    const ecdfPoints = ecdf(samples.map(s => s.MolLogP));
    const ctxEcdf = document.getElementById('ecdfChart').getContext('2d');
    new Chart(ctxEcdf, {
      type: 'line',
      data: {
        labels: ecdfPoints.map(p => p.x.toFixed(2)),
        datasets: [{
          label: 'ECDF',
          data: ecdfPoints.map(p=>p.y),
          fill: false,
          borderColor: '#0b5fff',
          tension: 0.2
        }]
      },
      options: {
        scales: {
          x: {title: {display: true, text: 'MolLogP'}},
          y: {title: {display: true, text: 'Cumulative Probability'}}
        },
        plugins: {
          legend: {display: false},
          title: {display: true, text: 'Empirical Cumulative Distribution of MolLogP'}
        }
      }
    });

    // Predicted vs Actual
    function makePredActData(n=180){
      const pts = [];
      for(let i=0;i<n;i++){
        const actual = -3 + Math.random()*5;
        const pred = actual + (Math.random()-0.5)*1.0;
        pts.push({x: actual, y: pred});
      }
      return pts;
    }
    const predActSynthetic = makePredActData();

    const ctxPred = document.getElementById('predActChart').getContext('2d');
    new Chart(ctxPred, {
      type: 'scatter',
      data: {
        datasets: [
          {
            label: 'Synthetic dataset (illustrative)',
            data: predActSynthetic.map(p => ({x:p.x, y:p.y})),
            backgroundColor: 'rgba(59,130,246,0.6)',
            pointRadius: 3
          },
          {
            label: 'Sample compounds',
            data: samples.map(s => ({x: s.logBB, y: s.predicted})),
            backgroundColor: 'rgba(16,185,129,0.95)',
            pointRadius: 6
          }
        ]
      },
      options: {
        scales: {
          x: {title: {display: true, text: 'Actual LogBB'}},
          y: {title: {display: true, text: 'Predicted LogBB'}}
        },
        plugins: {
          legend: {position: 'top'},
          title: {display: true, text: 'Model Predictions vs Actual Values'}
        },
        animation: false
      },
      plugins: [{
        id: 'drawLine',
        afterDatasetsDraw(chart) {
          const ctx = chart.ctx;
          const xAxis = chart.scales.x;
          const yAxis = chart.scales.y;
          const xMin = xAxis.min, xMax = xAxis.max;
          const x1 = xAxis.getPixelForValue(xMin);
          const y1 = yAxis.getPixelForValue(xMin);
          const x2 = xAxis.getPixelForValue(xMax);
          const y2 = yAxis.getPixelForValue(xMax);
          ctx.save();
          ctx.beginPath();
          ctx.setLineDash([6,6]);
          ctx.strokeStyle = 'red';
          ctx.lineWidth = 1.5;
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.stroke();
          ctx.restore();
        }
      }]
    });

    // Confusion matrix
    const confCounts = [[532, 12], [372, 120]];
    const confLabels = [['TN','FP'], ['FN','TP']];
    const confCanvas = document.getElementById('confMat');
    const cctx = confCanvas.getContext('2d');
    function drawConfusion(){
      const padding = 28;
      const cellW = (confCanvas.width - padding*2)/2;
      const cellH = (confCanvas.height - padding*2)/2;
      const maxVal = Math.max(...confCounts.flat());
      cctx.fillStyle = '#fff';
      cctx.fillRect(0,0,confCanvas.width,confCanvas.height);
      cctx.fillStyle = '#223';
      cctx.font = '14px system-ui, Arial';
      cctx.fillText('Confusion Matrix', padding, 18);
      for(let r=0;r<2;r++){
        for(let c=0;c<2;c++){
          const x = padding + c*cellW;
          const y = padding + r*cellH;
          const v = confCounts[r][c];
          const t = v / maxVal;
          const alpha = 0.45 + 0.5*t;
          cctx.fillStyle = `rgba(11,95,255,${alpha})`;
          cctx.fillRect(x+6, y+6, cellW-12, cellH-12);
          cctx.fillStyle = '#fff';
          cctx.font = '18px system-ui, Arial';
          cctx.textAlign = 'center';
          cctx.textBaseline = 'middle';
          cctx.fillText(String(v), x + cellW/2, y + cellH/2);
          cctx.fillStyle = '#0b5fff';
          cctx.font = '12px system-ui, Arial';
          cctx.textAlign = 'left';
          cctx.fillText(confLabels[r][c], x + 10, y + 16);
        }
      }
      cctx.fillStyle = '#223';
      cctx.font = '12px system-ui, Arial';
      cctx.textAlign = 'left';
      cctx.fillText('Actual →', padding, confCanvas.height - 6);
      cctx.save();
      cctx.translate(confCanvas.width - 6, 20);
      cctx.rotate(Math.PI / 2);
      cctx.textAlign = 'left';
      cctx.fillText('Predicted →', 0, 0);
      cctx.restore();
      const total = confCounts.flat().reduce((a,b)=>a+b,0);
      const correct = confCounts[0][0] + confCounts[1][1];
      const acc = (correct/total);
      cctx.fillStyle = '#223';
      cctx.font = '13px system-ui, Arial';
      cctx.textAlign = 'left';
      cctx.fillText(`Accuracy: ${acc.toFixed(3)}`, padding, confCanvas.height - 20);
    }
    drawConfusion();

    // Sample table
    const table = document.getElementById('sampleTable');
    let html = '<thead><tr><th>Compound</th><th>Actual LogBB</th><th>Predicted LogBB</th><th>MolLogP</th><th>MolWt</th><th>TPSA</th></tr></thead><tbody>';
    for(const s of samples){
      html += `<tr><td>${s.compound}</td><td>${s.logBB}</td><td>${s.predicted}</td><td>${s.MolLogP.toFixed(2)}</td><td>${s.MolWt.toFixed(1)}</td><td>${s.TPSA.toFixed(1)}</td></tr>`;
    }
    html += '</tbody>';
    table.innerHTML = html;
  </script>
</body>
</html>
